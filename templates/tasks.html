{% extends "base.html" %}

{% block title %}Tasks Board{% endblock %}

{% block content %}

<div class="board-wrapper">

    <!-- HEADER -->
    <div class="board-header">
        <div class="board-header-top">
            <div class="greeting">
                <div class="greeting-header">
                    <a href="{{ url_for('auth_bp.profile') }}" class="profile-icon-link" title="Profile">
                        <i class="fas fa-user-circle"></i>
                    </a>
                    <h1>Hello, {{ session.get('name', session.get('username', 'User')) }}!</h1>
                </div>
                <p>What are your priorities today?</p>
            </div>

            <!-- LIST SELECTOR AND ACTIONS -->
            <div class="list-controls">
                <div class="list-selector-container">
                    <label for="list-selector" class="list-label">Select lists:</label>
                    <select id="list-selector" class="list-selector">
                        <option value="personal">Personal Tasks</option>
                    </select>
                    <button id="create-collab-list-btn" class="collab-btn" title="Create Collaborative List">
                        <i class="fas fa-users"></i> New
                    </button>
                    <button id="toggle-archived-btn" class="archive-toggle-btn" title="Show Archived Tasks">
                        <i class="fas fa-archive"></i> Archived
                    </button>
                </div>
                
                <div id="collab-list-info" class="collab-list-info" style="display: none;">
                    <div class="collab-list-details">
                        <span id="collab-list-name"></span>
                        <div class="collab-meta">
                            <span id="collab-owner-badge" class="collab-owner-badge"></span>
                            <span id="collab-member-count" class="collab-member-count"></span>
                        </div>
                    </div>
                    <div class="collab-list-actions">
                        <button id="edit-list-btn" class="edit-list-btn" title="Edit List Name" style="display: none;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button id="delete-list-btn" class="delete-list-btn" title="Delete List" style="display: none;">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button id="manage-members-btn" class="manage-members-btn" title="Manage Members">
                            <i class="fas fa-user-plus"></i> Members
                        </button>

                    </div>
                </div>
            </div>
        </div>

        <!-- INPUT BAR -->
        <div class="task-input-bar">
            <input id="task-title-input" type="text" placeholder="Enter a new task...">
            
            <select id="task-priority-input">
                <option value="High">High Priority</option>
                <option value="Medium" selected>Medium Priority</option>
                <option value="Low">Low Priority</option>
            </select>

            <input id="task-date-input" type="date">

            <button id="task-add-btn" class="add-btn">
                <i class="fas fa-plus"></i> Add Task
            </button>
        </div>
    </div>

    <div id="create-collab-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Create Collaborative List</h2>
            <form id="create-collab-form">
                <label for="collab-list-name">List Name:</label>
                <input type="text" id="collab-list-name-input" required placeholder="e.g., Team Project">
                <button type="submit" class="submit-btn">Create List</button>
            </form>
        </div>
    </div>

    <div id="edit-list-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Edit List Name</h2>
            <form id="edit-list-form">
                <label for="edit-list-name">List Name:</label>
                <input type="text" id="edit-list-name-input" required placeholder="Enter new list name">
                <button type="submit" class="submit-btn">Save Changes</button>
            </form>
        </div>
    </div>

    <div id="manage-members-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Manage Members</h2>
            <div id="members-list"></div>
            <form id="add-member-form">
                <label for="member-username">Add Member (username or email):</label>
                <input type="text" id="member-username" required placeholder="Enter username or email">
                <button type="submit" class="submit-btn">Add Member</button>
            </form>
        </div>
    </div>

    <div id="board-loading-state" class="board-loading hidden">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p id="board-loading-message">Loading your tasks...</p>
    </div>

    <!-- KANBAN BOARD -->
    <div class="kanban-board">

        <!-- BACKLOGS -->
        <div class="kanban-column">
            <h2>BACKLOGS <span>↓</span></h2>
            <div class="kanban-list" id="backlog-list"></div>
        </div>

        <!-- IN PROGRESS -->
        <div class="kanban-column">
            <h2>IN PROGRESS <span>→</span></h2>
            <div class="kanban-list" id="progress-list"></div>
        </div>

        <!-- COMPLETED -->
        <div class="kanban-column">
            <h2>COMPLETED <span>→</span></h2>
            <div class="kanban-list" id="completed-list"></div>
        </div>

    </div>

    <!-- ARCHIVED TASKS SECTION -->
    <div id="archived-section" class="archived-section" style="display: none;">
        <div class="archived-header">
            <h2><i class="fas fa-archive"></i> Archived Tasks</h2>
            <p>Unarchive task before deletion.</p>
            <button id="hide-archived-btn" class="hide-archived-btn">
                <i class="fas fa-times"></i> Hide
            </button>
        </div>
        <div class="archived-tasks-list" id="archived-tasks-list"></div>
    </div>

    <!-- UNDO TOAST -->
    <div id="undo-toast" class="undo-toast hidden">
        Task deleted!
        <span id="undo-count">5</span>
        <button id="undo-btn">Undo</button>
    </div>

</div>

{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('pageshow', (event) => {
        const navEntry = performance.getEntriesByType('navigation')[0];
        if (event.persisted || navEntry?.type === 'back_forward') {
            forcePageReload();
        }
    });
    </script>
<script src="{{ url_for('static', filename='js/tasks.js') }}"></script>
{% endblock %}